#!/bin/zsh

# Fix $PATH for GUI context
export PATH="$PATH:/usr/local/bin:/opt/homebrew/bin:$HOME/bin"
if command -v brew >/dev/null 2>&1; then
  HOMEBREW_PREFIX=$(brew --prefix)
  export PATH="$PATH:$HOMEBREW_PREFIX/bin"
fi

file="$MM_EDIT_FILEPATH"
nvim_executable=$(command -v nvim)
if [[ -z "$nvim_executable" ]]; then
  echo "⚠️  Neovim not found. Please make sure it is installed and available in your \$PATH." >&2
  exit 1
fi

# Create a temporary shell script
tmp_script="$(mktemp -t mailmate-ghostty-nvim)"
cat >"$tmp_script" <<EOF
#!/bin/zsh
"$nvim_executable" -- "$file"
rm -f -- "\$0"
EOF
chmod +x "$tmp_script"

/usr/bin/open -n -F -a "Ghostty" --args -e "$tmp_script"