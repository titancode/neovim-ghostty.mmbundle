#!/bin/zsh

file="$MM_EDIT_FILEPATH"

# Try to locate Neovim in PATH
nvim_path=$(command -v nvim)

# If not found, fall back to a common installation path (Homebrew on Apple Silicon)
[[ -z "$nvim_path" ]] && nvim_path="/opt/homebrew/bin/nvim"

# If still not found, show error message and exit
if [[ ! -x "$nvim_path" ]]; then
  echo "⚠️ Neovim not found. Please make sure it is installed or manually update the nvim path in this script." >&2
  exit 1
fi

# Escape the file path to be safe in shell string
escaped_file=$(printf %q "$file")
escaped_nvim=$(printf %q "$nvim_path")

# Open Neovim in Ghostty via shell
/usr/bin/open -na "Ghostty" --args -e "zsh -c '$escaped_nvim $escaped_file'"
